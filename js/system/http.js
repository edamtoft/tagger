define(["system/text","system/logManager","system/enumerable"],function(a,b,c){"use strict";var d=function(){function d(b,d,e){function g(){p=!0,f.info("Making {0} request to {1}",b,d),r.open(b,d+n),c.of(o).each(function(a){r.setRequestHeader(a.key,a.value)}),r.send(m),r.onprogress=function(a){k&&k(a.loaded/a.total)},r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){q=!0;var a=r.getResponseHeader("Content-Type")||"";switch(a.split(/;\s*/)[0].toLowerCase()){case"application/json":s=JSON.parse(r.responseText);break;default:s=r.responseText}switch(r.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:f.info("Recieved response from {0} with status {1} {2}",d,r.status,r.statusText),"function"==typeof h&&h(s,r.status,r.statusText,r.getAllResponseHeaders());break;default:f.error("Recieved error code {0} {1} from {1}",r.status,r.statusText,d),"function"==typeof i&&i(s,r.status,r.statusText,r.getAllResponseHeaders())}"function"==typeof j&&j(s,r.status,r.statusText,r.getAllResponseHeaders())}}}var h,i,j,k,l=this,m=null,n="",o={},p=!1,q=!1,r=new XMLHttpRequest,s=null;d=a.from(d,e),this.withHeader=function(a,b){return o[a]=b,l},this.withQuery=function(b){return n+=-1===n.indexOf("?")?"?":"&",n+="object"==typeof b?a.toQuery(b):b.toString(),l},this.withBasicAuth=function(b,c){return o.Authorization="basic "+btoa(a.from("{0}:{1}",b,c)),l},this.withAuth=function(b,c){return o.Authorization=a.from("{0}:{1}",b,c),l},this.send=function(a){return a?("object"==typeof a?(o["Content-Type"]="Application/JSON",m=JSON.stringify(a)):(o["Content-Type"]="Text/Plain",m=a.toString()),g(),l):(g(),l)},this.progress=function(a){return q&&a(1),k=a,l},this.success=function(a){return p||g(),q?(a(s,r.status,r.statusText,r.getAllResponseHeaders()),l):(h=a,l)},this.error=function(a){return p||g(),q?(a(s,r.status,r.statusText,r.getAllResponseHeaders()),l):(i=a,l)},this.done=function(a){return p||g(),q?(a(s,r.status,r.statusText,r.getAllResponseHeaders()),l):(j=a,l)}}var e=this,f=b.getLogger("Http Handler");this.method={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},this.makeRequest=function(a,b,c){return new d(a,b,c)},this.get=function(a,b){return new d(e.method.GET,a,b)},this.put=function(a,b){return new d(e.method.PUT,a,b)},this.post=function(a,b){return new d(e.method.POST,a,b)},this["delete"]=function(a,b){return new d(e.method.DELETE,a,b)}};return new d});